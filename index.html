<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Employee Year × Section Grid</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    overflow: hidden;
  }
  svg {
    width: 100vw;
    height: 100vh;
    background: #f5f6fa;
  }
  .node rect {
    stroke: #333;
    stroke-width: 1.2px;
    rx: 6;
    ry: 6;
  }
  .node text {
    font-size: 13px;
    pointer-events: none;
  }
  .yearLabel, .sectionLabel {
    font-size: 18px;
    font-weight: bold;
    fill: #333;
  }
  .edge {
    stroke: #555;
    stroke-width: 2px;
    fill: none;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
</head>
<body>

<svg id="svg"></svg>

<script>
// ---------------------------------------------------------
// ★ ここに社員データを入れる（年だけ使う）
// ---------------------------------------------------------
const employees = [
  { "name": "Aさん", "year": 2001, "section": "Engineer" },
  { "name": "Bさん", "year": 2002, "section": "Engineer" },
  { "name": "Dさん", "year": 2003, "section": "Engineer" },

  { "name": "Cさん", "year": 2001, "section": "Planner" },

  { "name": "Eさん", "year": 2003, "section": "Designer" },
  { "name": "Fさん", "year": 2003, "section": "Designer" }
];

// ---------------------------------------------------------
// セクション定義（色つき）
// ---------------------------------------------------------
const sections = [
  { name: "Engineer", color: "#4CAF50" },
  { name: "Planner",  color: "#2196F3" },
  { name: "Designer", color: "#FF9800" }
];

// ---------------------------------------------------------
// レイアウト設定
// ---------------------------------------------------------
const cellWidth = 200;   // 年度幅
const cellHeight = 150;  // セクション高さ
const nodeWidth = 140;
const nodeHeight = 40;

const svg = d3.select("#svg");
const g = svg.append("g");

// パン・ズーム
svg.call(d3.zoom()
  .scaleExtent([0.4, 2])
  .on("zoom", ev => g.attr("transform", ev.transform))
);

// ---------------------------------------------------------
// 年度一覧を抽出してソート
// ---------------------------------------------------------
const years = [...new Set(employees.map(e => e.year))].sort();

// ---------------------------------------------------------
// 年度ラベル描画
// ---------------------------------------------------------
years.forEach((year, i) => {
  g.append("text")
    .attr("class", "yearLabel")
    .attr("x", i * cellWidth + cellWidth / 2)
    .attr("y", 40)
    .attr("text-anchor", "middle")
    .text(`${year}年`);
});

// ---------------------------------------------------------
// セクションラベル描画
// ---------------------------------------------------------
sections.forEach((sec, j) => {
  g.append("text")
    .attr("class", "sectionLabel")
    .attr("x", 10)
    .attr("y", j * cellHeight + 140)
    .text(sec.name);
});

// ---------------------------------------------------------
// グリッド座標に社員を配置
// ---------------------------------------------------------
let placed = []; // { id, x, y, section, year, name }

sections.forEach((sec, secIndex) => {
  years.forEach((year, yearIndex) => {

    const people = employees.filter(e =>
      e.section === sec.name && e.year === year
    );

    // 同年に複数人いれば横に並べる
    people.forEach((p, i) => {
      const x = yearIndex * cellWidth + 100 + (i * (nodeWidth + 10));
      const y = secIndex * cellHeight + 100;

      placed.push({
        id: `${p.name}_${year}_${sec.name}`,
        name: p.name,
        section: sec.name,
        color: sec.color,
        year,
        x,
        y
      });
    });
  });
});

// ---------------------------------------------------------
// セクション内の縦線（年の順に並べてつなぐ）
// ---------------------------------------------------------
sections.forEach(sec => {
  const list = placed
    .filter(p => p.section === sec.name)
    .sort((a, b) => a.year - b.year);

  for (let i = 0; i < list.length - 1; i++) {
    g.append("line")
      .attr("class", "edge")
      .attr("x1", list[i].x + nodeWidth / 2)
      .attr("y1", list[i].y + nodeHeight)
      .attr("x2", list[i + 1].x + nodeWidth / 2)
      .attr("y2", list[i + 1].y)
      .attr("stroke", sec.color);
  }
});

// ---------------------------------------------------------
// ノード描画
// ---------------------------------------------------------
const node = g.selectAll(".node")
  .data(placed)
  .enter()
  .append("g")
  .attr("class", "node")
  .attr("transform", d => `translate(${d.x}, ${d.y})`);

node.append("rect")
  .attr("width", nodeWidth)
  .attr("height", nodeHeight)
  .attr("fill", d => d.color);

node.append("text")
  .attr("x", nodeWidth / 2)
  .attr("y", nodeHeight / 2 + 5)
  .attr("text-anchor", "middle")
  .text(d => d.name);

</script>

</body>
</html>
